# 商品分类-添加的功能

+ 思路

```js
1. 给确定注册点击事件
2. 给表单做校验
3. 发送ajax请求，获取到ajax请求需要的参数
4. 如果成功了
	4.1 关闭对话框
    4.2 清除提示信息
    4.3 重新渲染列表
    4.4 给一个提示信息
5. 如果失败了，直接给一个提示信息
```

+ 给确定按钮注册事件

```html
 <el-button type="primary" @click="addCategory">确 定</el-button>
```

+ 提供方法，进行添加

```js
    addCategory() {
      this.$refs.addForm.validate(async valid => {
        if (!valid) {
          return false
        }
 		// 发送ajax请求
      })
    }
```

+ ajax请求需要参数`cat_pid cat_name cat_level`

```html
<el-cascader
             clearable
             :options="options"
             change-on-select
             :props="props"
             v-model="addForm.cat_pid"
             ></el-cascader>

<script>
 // 发送ajax请求
let { cat_name, cat_pid } = this.addForm
let res = await this.axios.post('categories', {
    // 如果是一级分类，pid为0
    cat_pid: cat_pid[cat_pid.length - 1] || 0,
    cat_name,
    cat_level: cat_pid.length
})
</script>
```

+ 发送ajax请求，处理成功的响应

```js
// 发送ajax请求
let { cat_name, cat_pid } = this.addForm
let res = await this.axios.post('categories', {
    // 如果是一级分类，pid为0
    cat_pid: cat_pid[cat_pid.length - 1] || 0,
    cat_name,
    cat_level: cat_pid.length
})

let { meta: { status, msg } } = res.data
if (status === 201) {
    this.addDialogVisible = false
    this.$refs.addForm.resetFields()
    this.getCategoryList()
    this.$message.success('添加商品分类成功了')
} else {
    this.$message.error(msg)
}
```

+ eslint报错，要求变量必须是驼峰命名

```js
 let { cat_name: catName, cat_pid: catPid } = this.addForm
 let res = await this.axios.post('categories', {
     // 如果是一级分类，pid为0
     cat_pid: catPid[catPid.length - 1] || 0,
     cat_name: catName,
     cat_level: catPid.length
 })
```



# 商品分类-删除功能

+ 思路

```js
1. 给删除按钮注册点击事件（把id传过去）
2. 给一个确认框，是否要删除
3. 发送ajax请求，进行删除即可
4. 成功
	4.1 重新渲染
    4.2 提示内容
```



# 商品管理-列表的展示功能

+ 商品信息的展示
+ 分页的功能（需要自定义索引）
+ 时间的过滤功能 （时间需要乘以1000）



# 商品管理-准备添加商品的组件

+ 在components中的products文件加中新建了Add.vue
+ 在router/index.js中配置了

```json
 {
     path: '/goods-add',
     name: 'goods-add',
     component: Add
 }
```

+ 点击添加商品的时候，路由进行了跳转

```html
<el-button type="success" plain @click="$router.push('/goods-add')">添加商品</el-button>
```

+ 发现问题：商品列表不能高亮

```js
原因： 商品列表的index的值 goods   路由中的路径 /goods-add

// 修改了home.vue中导航的default-active
<el-menu
    :default-active="$route.path.slice(1).split('-')[0]"
    background-color="#545c64"
    text-color="#fff"
    active-text-color="#ffd04b"
    unique-opened
    router>
```



# 商品管理-使用了步骤条组件和tabs组件

+ 步骤条组件

```html
    <!-- 步骤条 -->
    <el-steps :active="active" finish-status="success">
      <el-step title="步骤 1" description="基本信息"></el-step>
      <el-step title="步骤 2" description="商品图片"></el-step>
      <el-step title="步骤 3" description="商品内容"></el-step>
    </el-steps>

提供一个数据 ： active
<script>
  data() {
    return {
      active: 0
    }
  },
</script>
```

+ tabs组件

```html
<!-- tabs组件 -->
    <el-tabs
      tab-position="left"
      style="height: 200px;"
      @tab-click="change"
    >
      <el-tab-pane label="基本信息">基本信息</el-tab-pane>
      <el-tab-pane label="商品图片">商品图片</el-tab-pane>
      <el-tab-pane label="商品内容">商品内容</el-tab-pane>
    </el-tabs>
```

# 商品管理-tabs组件和步骤条组件联动

```js
  methods: {
    change(tab) {
      // 修改active的值
      this.active = +tab.index
    }
  }
```



# 商品管理-添加商品的基本信息

+ 使用了一个el-form组件

```html
<el-form :model="form" label-width="80px">
    <el-form-item label="商品名称">
        <el-input v-model="form.goods_name"></el-input>
    </el-form-item>
    <el-form-item label="商品价格">
        <el-input v-model="form.goods_price"></el-input>
    </el-form-item>
    <el-form-item label="商品重量">
        <el-input v-model="form.goods_weight"></el-input>
    </el-form-item>
    <el-form-item label="商品数量">
        <el-input v-model="form.goods_number"></el-input>
    </el-form-item>
    <el-form-item label="商品分类">
        <el-cascader
                     :options="options"
                     v-model="form.goods_cat"
                     :props="props">
        </el-cascader>
    </el-form-item>
    <el-form-item label="是否促销">
        <el-radio v-model="form.is_promote" :label="true">是</el-radio>
        <el-radio v-model="form.is_promote" :label="false">否</el-radio>
    </el-form-item>
    <el-form-item>
        <el-button type="primary">下一步</el-button>
    </el-form-item>
</el-form>
```

+ 在data中提供数据

```json
form: {
    goods_name: '',
    goods_price: '',
    goods_weight: '',
    goods_number: '',
    goods_cat: [], // 存放级联的id值
    is_promote: false // 是否促销
},
```

+ 获取到分类的数据（3层）

```js
// 发送请求，获取数据
    let res = await this.axios.get('categories?type=3')
    let { meta: { status }, data } = res.data
    if (status === 200) {
      this.options = data
    }
```



# 商品管理-下一步功能

+ 给下一步注册了点击事件

```html
<el-button type="primary" @click="next">下一步</el-button>
```

+ 给tabs的每一项都执行要给name属性

```html
<el-tabs
      tab-position="left"
      @tab-click="change"
         // 对应了需要显示的tab
      v-model="activeName"
    >
<el-tab-pane name="pic" label="商品图片">商品图片</el-tab-pane>
 <el-tab-pane name="content" label="商品内容">商品内容</el-tab-pane>
```

+ 点击的时候需要切换tabs和步骤条

```js
next() {
    this.active = 1
    this.activeName = 'pic'
}
```



# 商品管理-图片上传

+ 复制图片上传组件

```html
<!-- 上传图片的组件 -->
<!-- action：指定图片上传的地址 -->
<!-- headers:设置token -->
<el-upload
           class="upload-demo"
           action="http://localhost:8888/api/private/v1/upload"
           list-type="picture"
           :headers="headers"
           :on-success="handlerSucess">
    <el-button size="small" type="primary">点击上传</el-button>
    <div slot="tip" class="el-upload__tip">只能上传jpg/png文件，且不超过500kb</div>
</el-upload>
```

+ 在成功的时候， handlerSucess需要把上传成功的图片存储到 pics中，因为添加商品的时候需要使用

```js
handlerSucess(response, file, fileList) {
    // 通过response获取到上传成功后的图片的地址
    // 存储到this.form.pics中
    this.form.pics.push({
        pic: response.data.tmp_path
    })
}
```

+ 图片移除





# 商品管理-富文本编辑器的使用

[vue-quill-editor](https://github.com/surmon-china/vue-quill-editor)

+ 安装

```bash
npm install vue-quill-editor
```

+ 导入

```js
// 导入富文本编辑器
import VueQuillEditor from 'vue-quill-editor'
// 导入富文本编辑器的css
import 'quill/dist/quill.core.css'
import 'quill/dist/quill.snow.css'
import 'quill/dist/quill.bubble.css'
```

+ 绑定

```js
// 把富文本编辑器当成了vue的插件，以后所有的组件中都可以直接使用了
Vue.use(VueQuillEditor)
```



+ 在项目中使用富文本编辑器

```js
 <quill-editor class="myEditor" v-model="form.goods_introduce"></quill-editor>
```



# scoped坑的问题

[vue中的scoped坑点](https://blog.csdn.net/sdo2605587/article/details/79141111)

[[Vue踩坑记\]scoped CSS](https://segmentfault.com/a/1190000015226237)

